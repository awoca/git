import XCTest
import Git

final class OpenTests: Tests {
    func testNoRepository() {
        let expect = expectation(description: "")
        git.open(url).sink {
            XCTAssertNil($0)
            XCTAssertEqual(.main, Thread.current)
            expect.fulfill()
        }.store(in: &subs)
        waitForExpectations(timeout: 1)
    }
    
    func testOpenAfterCreate() {
        var repository: Repository!
        let expect = expectation(description: "")
        git.create(url).sink {
            repository = $0
            self.git.open(self.url).sink {
                repository = $0
                XCTAssertEqual(.main, Thread.current)
                XCTAssertEqual(self.url, repository.url)
                expect.fulfill()
            }.store(in: &self.subs)
        }.store(in: &subs)
        waitForExpectations(timeout: 1)
    }
}
